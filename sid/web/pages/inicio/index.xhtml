<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:gc="http://xmlns.jcp.org/jsf/composite/gc"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:composition template="../template/template.xhtml">
        <ui:define name="content">
            <h:form>
            <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-md-flex align-items-center">
                                    <div>
                                        <h4 class="card-title">Projects of the Month</h4>
                                        <h5 class="card-subtitle">Overview of Latest Month</h5>
                                    </div>
                                    <div class="ml-auto d-flex no-block align-items-center">
                                        <div class="dl">
                                            <select class="custom-select">
                                                <option value="0" selected="true">Monthly</option>
                                                <option value="1">Daily</option>
                                                <option value="2">Weekly</option>
                                                <option value="3">Yearly</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table no-wrap v-middle">
                                        <thead>
                                            <tr class="border-0">
                                                <th class="border-0">Nro</th>
                                                <th class="border-0">Expediente</th>
                                                <h:panelGroup rendered="#{seguridadUtilController.tieneRecurso('REC_EXP008')}">
                                                <th class="border-0">Comisionado</th>
                                                </h:panelGroup>
                                                
                                                <th class="border-0">Tipo</th>
                                                <th class="border-0">Fecha Registro</th>
                                                <th class="border-0">Etapa</th>
                                                <th class="border-0">Estado general</th>
                                                <th class="border-0">Estado registro</th>
                                                <th class="border-0"></th>
                                                <th class="border-0"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <c:forEach var="x" items="#{registroController.listaExpedienteXUsuarioPaginado}" varStatus="loop">
                                   <tr>
                                                <td>
                                                    <div class="d-flex no-block align-items-center">
                                                        <div class="m-r-10"></div>
                                                        <div class="">
                                                            <h5 class="m-b-0 font-16 font-medium">${loop.index+1}</h5></div>
                                                    </div>
                                                </td>
                                                <td><label title="#{x.sumilla == null? '' : x.sumilla}" class="label label-danger">#{x.numero}</label></td>
                                                <h:panelGroup rendered="#{seguridadUtilController.tieneRecurso('REC_EXP008')}">
                                                    <td><h:outputText value="#{x.comisionado}" /></td>
                                                </h:panelGroup>
                                                
                                                <td>
                                                    <h:outputText value="#{x.clasificacionTipoNombre}" />
                                                </td>
                                                <td><h:outputText value="#{x.fechaRegistro}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </td>
                                                <td><h:outputText value="#{x.etapaDetalle}" /></td>
                                                <td class="blue-grey-text  text-darken-4 font-medium"><h:outputText rendered="#{x.general == 'A'}" value="Trámite" />
                                                    <h:outputText rendered="#{x.general == 'C' and x.indicadorDesestimiento == null}" value="Concluido" />
                                                    <h:outputText rendered="#{x.general == 'C' and x.indicadorDesestimiento == 1}" value="Desistido" />
                                                </td>
                                                <td><h:outputText value="#{x.version == 0? 'Borrador' : 'En registro' }" /></td>
                                                <td>
                                                    <button class="btn btn-info btn-circle" jsf:action="#{registroController.cargarExpedienteEdit(x)}"><i class="fas fa-pencil-alt" ></i> </button>
                                                </td>
                                                <td>
                                                    
                                                    <a class="btn btn-danger btn-circle" onclick="confirmar4#{loop.index+1}()"><i class="fas fa-trash" ></i> </a>
                                                    
                                                    <script>
                                                        function confirmar4#{loop.index+1}() {
                                                            $(".confirmacion4#{loop.index+1}").modal('show');
                                                        }
                                                    </script>
                                                    <gc:confirmSubmit bean="#{registroController.inactivarExpediente(x)}" classGC="confirmacion4#{loop.index+1}" mensaje="Esta seguro de inactivar el expediente, esta acción no se puede revertir?" />
                                                </td>
                                            </tr>
                                </c:forEach>
                                            
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
            
                <table style="width: 100%">
                    <tr>
                        <td></td>
                        <td style="text-align: right">
                            <h:panelGroup rendered="#{!seguridadUtilController.tieneRol('ROL0000005') and !seguridadUtilController.tieneRol('ROL0000006') and !seguridadUtilController.tieneRol('ROL0000010')}" >
                                <a class="btn btn-primary" jsf:action="#{registroController.cargarNuevaBusqueda()}">
                                    <span class="glyphicon glyphicon-user"/>
                                    Atención al Usuario
                                </a>
                            </h:panelGroup>
                        </td>
                    </tr>
                </table>
                <br/>
                <div class="panel panel-primary">
                    <script>
                        function openModal(b) {
                            if (b.status === "success") {
                                $("#myModal").modal("show");
                            }
                        }

                        $(document).ready(function () {
                            $(".tooltip-right").tooltip(
                                    {placement: "right", viewport:
                                    {selector: "body", padding: 2}
                                    }
                            );
                        }
                        );
                    </script>
                    <div class="panel-body">
                        <table style="width: 100%" class="table">
                            <tr>
                                <td colspan="2" style="width: 50%; padding-right: 2px;">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            <span >Lista de Expedientes</span>
                                        </div>
                                        <div class="panel-body">
                                            
                                            <ul class="pager">
                                                <li>
                                                    <a jsf:action="#{registroController.listarExpedienteUsuarioPaginado(registroController.nroPagina -1)}" jsf:rendered="#{!empty registroController.listaExpedienteXUsuarioPaginado}" jsf:onclick="loadingModal()">Anterior
                                                        <f:ajax render="@form" onevent="closeModal"/>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a jsf:action="#{registroController.listarExpedienteUsuarioPaginado(registroController.nroPagina +1)}" jsf:rendered="#{!empty registroController.listaExpedienteXUsuarioPaginado}" jsf:onclick="loadingModal()">Siguiente
                                                        <f:ajax render="@form" onevent="closeModal"/>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                        <table style="width: 100%">
                            <tr>
                                <td style="padding-right: 2px; width: 50%; vertical-align: top">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            <span >Atenciones</span>
                                        </div>
                                        <div class="panel-body">

                                            <script>
                                                $(function () {
                                                    // Use Morris.Bar
                                                    Morris.Bar({
                                                        element: 'graph',
                                                        data: [
                                                #{registroController.grafico001}
                                                        ],
                                                        xkey: 'x',
                                                        ykeys: ['y'],
                                                        labels: ['Y']
                                                    }).on('click', function (i, row) {
                                                        console.log(i, row);
                                                    });

                                                    // Use Morris.Bar
                                                    Morris.Bar({
                                                        element: 'graph2',
                                                        data: [
                                                #{registroController.grafico002}
                                                        ],
                                                        xkey: 'x',
                                                        ykeys: ['y', 'z'],
                                                        labels: ['Trámite', 'Concluido']
                                                    }).on('click', function (i, row) {
                                                        console.log(i, row);
                                                    });


                                                    var month_data = [
                                                #{registroController.grafico003}
                                                    ];
                                                    Morris.Line({
                                                        element: 'graph3',
                                                        data: month_data,
                                                        xkey: 'period',
                                                        ykeys: ['queja', 'consulta', 'petitorio'],
                                                        labels: ['queja', 'consulta', 'petitorio'],
                                                        smooth: false
                                                    });

                                                });
                                            </script>
                                            <div id="graph"></div>

                                        </div>
                                    </div>
                                </td>
                                <td style="padding-left: 2px; vertical-align: top">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            <span >Gestión de Casos</span>
                                        </div>
                                        <div class="panel-body">
                                            <div id="graph2"></div>
                                        </div>

                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            <span >Otros Gráficos</span>
                                        </div>
                                        <div class="panel-body">

                                            <div id="graph3"></div>

                                        </div>

                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </h:form> 
        </ui:define>
    </ui:composition>
</html>            
